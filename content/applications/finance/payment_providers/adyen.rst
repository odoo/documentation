=====
Adyen
=====

`Adyen <https://www.adyen.com/>`_ is a Dutch company that offers several online payment
possibilities.

.. seealso::
   - :ref:`payment_providers/add_new`
   - :doc:`../payment_providers`

.. note::
   Adyen works only with customers processing **more** than **10 million annually** or invoicing a
   **minimum** of **1.000** transactions **per month**.

Configuration
=============

.. seealso::
   :ref:`payment_providers/add_new`

First, reach Adyen support to enable :guilabel:`multiple partial capture` for you.

Credentials tab
---------------

Odoo needs your **API Credentials** to connect with your Adyen account, which comprise:

- **Merchant Account**: The code of the merchant account to use with Adyen.
- :ref:`API Key <adyen/api_and_client_keys>`: The API key of the webservice user.
- :ref:`Client Key <adyen/api_and_client_keys>`: The client key of the webservice user.
- :ref:`HMAC Key <adyen/hmac_key>`: The HMAC key of the webhook.
- :ref:`Checkout API URL <adyen/urls>`: The base URL for the Checkout API endpoints.
- :ref:`Recurring API URL <adyen/urls>`: The base URL for the Recurring API endpoints.

You can copy your credentials from your Adyen account, and paste them in the related fields under
the **Credentials** tab.

.. important::
   If you are trying Adyen as a test, with an Adyen *test account*, head to
   :menuselection:`Accounting --> Configuration --> Payment Providers`. There, click on
   :guilabel:`Adyen`, enable :guilabel:`Test Mode` and enter your credentials in the
   :guilabel:`Credentials` tab.

.. _adyen/api_and_client_keys:

API Key and Client Key
~~~~~~~~~~~~~~~~~~~~~~

In order to retrieve the API Key and the Client Key, log into your Adyen account, go to
:menuselection:`Developers --> API Credentials`.

- If you already have an API user, open it.
- If you don't have an API user yet, click on **Create new credential**.

Go to :menuselection:`Server settings --> Authentification` and copy or generate your **API Key**.
Be careful to copy your API key as you'll not be allowed to get it later without generating a new
one.

Now, head to :menuselection:`Client settings --> Authentification` and cody or generate your
**Client Key**. This is also the place where you can :ref:`allow payments to be made from your
website <adyen/allowed_origins>`.

.. _adyen/hmac_key:

HMAC key
~~~~~~~~

In order to retrieve the HMAC Key, you'll need to configure a `Standard Notification` webhook. For
this, log into your Adyen account then go to :menuselection:`Developers --> Webhooks --> Add webhook
--> Add Standard notification`.

.. image:: adyen/adyen-add-webhook.png
   :align: center
   :alt: Configure a webhook.

There, in :menuselection:`General --> Server configuration --> URL`, enter your server address
followed by `/payment/adyen/notification`.

.. image:: adyen/adyen-webhook-url.png
   :align: center
   :alt: Enter the notification URL.

Then enter :menuselection:`Security --> HMAC Key --> Generate`. Be careful to copy the key as you
will not be allowed to do it later without generating a new one.

.. image:: adyen/adyen-hmac-key.png
   :align: center
   :alt: Generate a HMAC key and save it.

You have to save the webhook to finalize its creation.

.. _adyen/urls:

API URLs
~~~~~~~~

All Adyen API URLs include a customer area-specific prefix generated by Adyen. To configure the
URLs, proceed as follows:

#. Log into your Adyen account, then go to :menuselection:`Developers --> API URLs`.
#. Copy the :guilabel:`Prefix` for your live Customer area (i.e., **data center**) and save it for
   later.

   .. image:: adyen/adyen-api-urls.png
     :alt: Copy the prefix for the Adyen APIs

#. In Odoo, :ref:`navigate to the payment provider Adyen <payment_providers/add_new>`.
#. In the :guilabel:`Checkout API URL` field, enter the following URL and replace `yourprefix` with
   the prefix you previously saved:
   `https://yourprefix-checkout-live.adyenpayments.com/checkout`
#. In the :guilabel:`Recurring API URL` field, enter the following URL and replace `yourprefix` with
   the prefix you previously saved:
   `https://yourprefix-pal-live.adyenpayments.com/pal/servlet/Recurring`.

.. note::
   If you are trying Adyen as a test, you can use the following URLs instead:

   - :guilabel:`Checkout API URL`: `https://checkout-test.adyen.com`
   - :guilabel:`Recurring API URL`: `https://pal-test.adyen.com/pal/servlet/Recurring`

Adyen Account
-------------

.. _adyen/allowed_origins:

Allow payments from a specific origin
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To allow payment originated from your website, follow the steps in :ref:`adyen/api_and_client_keys`
to navigate to your API user and go to :menuselection:`Add allowed origins`, then add the URLs from
where payments will be made (the URLs of the servers hosting your Odoo instances).

.. image:: adyen/adyen-allowed-origins.png
   :align: center
   :alt: Allows payments originated from a specific domain.

Place a hold on a card
----------------------

Adyen allows you to capture an amount manually instead of having an immediate capture.

To set it up, enable the **Capture Amount Manually** option on Odoo, as explained in the
:ref:`payment providers documentation <payment_providers/manual_capture>`.

Then, open your Adyen Merchant Account, go to :menuselection:`Account --> Settings`, and set the
**Capture Delay** to **manual**.

.. image:: adyen/adyen_capture_delay.png
   :align: center
   :alt: Capture Delay settings in Adyen

.. caution::
   If you configure Odoo to capture amounts manually, make sure to set the **Capture Delay** to
   **manual** on Adyen. Otherwise, the transaction will be blocked in the authorized state in
   Odoo.

.. note::
   After **7 days**, if the transaction has not been captured yet, the customer has the right to
   **revoke** it.

.. seealso::
   :doc:`../payment_providers`

Supported payment methods and features in Odoo
==============================================

.. |V| replace:: :icon:`fa-check`
.. |X| replace:: :icon:`fa-times`

.. list-table::
   :header-rows: 1
   :stub-columns: 1
   :widths: 10 25 25 8 8 8 8 8

   * - Payment method
     - Currencies
     - Countries
     - Manual capture
     - Partial capture
     - Refunds
     - Partial refunds
     - Tokenization
   * - ACH Direct Debit
     - USD
     - Puerto Rico, United States
     - |V|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Affirm
     - USD
     - USA
     - |V|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Afterpay (Clearpay)
     - AUD, CAD, NZD, USD
     - Australia, Canada, New Zealand, United States
     - |V|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Alipay
     - All except CNY
     - Australia, Austria, Belgium, Bulgaria, Canada, Croatia, Cyprus, Czech Republic, Denmark,
       Estonia, Finland, France, Germany, Greece, Hong Kong, Hungary, Iceland, India, Indonesia,
       Italy, Japan, Latvia, Lithuania, Luxembourg, Malaysia, Malta, Netherlands, New Zealand,
       Norway, Philippines, Poland, Portugal, Puerto Rico, Romania, Singapore, Slovakia, Slovenia,
       South Korea, Spain, Sweden, Switzerland, Taiwan, Thailand, United Kingdom, United States,
       Vietnam
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - AlipayHK
     - HKD
     - Hong Kong
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Alma
     - EUR
     - France
     - |V|
     - |V|
     - |V|
     - |V|
     - |X|
   * - BACS Direct Debit
     - GBP
     - United Kingdom
     - |V|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Bancontact
     - EUR
     - Belgium
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Benefit
     - BHD
     - Bahrain
     - |X|
     - |X|
     - |V|
     - |X|
     - |X|
   * - Bizum
     - EUR
     - Spain
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - BLIK
     - PLN
     - Poland
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Card
     - All
     - All
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - Cash App Pay
     - USD
     - United States
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Clearpay
     - GBP
     - United Kingdom
     - |V|
     - |V|
     - |V|
     - |V|
     - |X|
   * - DANA
     - IDR
     - Indonesia
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - DuitNow
     - MYR
     - MY
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Elo
     - All
     - All
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - EPS
     - EUR
     - Austria
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - FPX
     - MYR
     - Malaysia
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - GCash
     - PHP
     - Philippines
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Giropay
     - EUR
     - Germany
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - GoPay
     - IDR
     - Indonesia
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Hipercard
     - All
     - All
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - iDEAL
     - EUR
     - Netherlands
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - KakaoPay
     - KRW
     - South Korea
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Klarna
     - AUD, CAD, CHF, CZK, DKK, EUR, GBP, NOK, NZD, PLN, SEK, USD
     - Australia, Austria, Belgium, Canada, Czech Republic, Denmark, Finland, France, Germany,
       Greece, Ireland, Italy, Netherlands, New Zealand, Norway, Poland, Portugal, Spain, Sweden,
       Switzerland, United Kingdom, United States
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - Klarna - Pay later
     - CHF, DKK, EUR, GBP, NOK, PLN, SEK
     - Austria, Belgium, Denmark, Finland, Germany, Netherlands, Norway, Poland, Sweden,
       Switzerland, United Kingdom
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - Klarna - Pay Now
     - CHF, EUR, SEK
     - Germany, Netherlands, Sweden, Switzerland
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - Klarna - Pay over time
     - UD, CAD, DKK, EUR, GBP, NOK, SEK, USD
     - Australia, Austria, Canada, Czech Republic, Denmark, Finland, France, Germany, Greece,
       Ireland, Italy, Netherlands, New Zealand, Norway, Portugal, Spain, Sweden, United Kingdom,
       United States
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - KNET
     - KWD
     - Kuwait
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - MB WAY
     - EUR
     - Portugal
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - MobilePay
     - DKK, EUR, NOK, SEK
     - Denmark, Finland
     - |V|
     - |V|
     - |V|
     - |V|
     - |X|
   * - MoMo
     - VND
     - Vietnam
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Multibanco
     - EUR
     - Portugal
     - |X|
     - |X|
     - |X|
     - |X|
     - |X|
   * - Napas card
     - VND
     - Vietnam
     - |X|
     - |X|
     - |V|
     - |X|
     - |X|
   * - Online Banking Czech Republic
     - CZK
     - Czech Republic
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Online Banking India
     - INR
     - India
     - |X|
     - |X|
     - |V|
     - |X|
     - |V|
   * - Online Banking Slovakia
     - EUR
     - Slovakia
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Online Banking Thailand
     - THB
     - Thailand
     - |X|
     - |X|
     - |X|
     - |X|
     - |X|
   * - Open Banking
     - GBP
     - Great Britain
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - P24 - Przelewy24
     - EUR, PLN
     - Poland
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - PayBright
     - CAD
     - Canada
     - |V|
     - |V|
     - |V|
     - |V|
     - |X|
   * - PayNow
     - SGD
     - Singapore
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - PayPal
     - All
     - All
     - |V|
     - |V|
     - |V|
     - |V|
     - |X|
   * - PaySafeCard
     - AED, AUD, BRL, CAD, CHF, CZK, DKK, EUR, GBP, GEL, GIP, HUF, ISK, KWD, MDL, MXN, NZD, PEN,
       PLN, PYG, RON, RSD, SAR, SEK, TRY, USD, UYU
     - Australia, Austria, Belgium, Brazil, Canada, Croatia, Cyprus, Czech Republic, Denmark,
       Finland, France, Georgia, Germany, Gibraltar, Hungary, Iceland, Ireland, Italy, Kuwait,
       Latvia, Liechtenstein, Lithuania, Luxembourg, Malta, Mexico, Moldova, Montenegro,
       Netherlands, New Zealand, Norway, Paraguay, Peru, Poland, Portugal, Romania, Saudi Arabia,
       Serbia, Slovakia, Slovenia, Spain, Sweden, Switzerland, Turkey, United Arab Emirates, United
       Kingdom, United States, Uruguay
     - |X|
     - |X|
     - |V|
     - |X|
     - |X|
   * - Paytm
     - INR
     - India
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Paytrail
     - EUR
     - Finland
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Pix
     - BRL
     - Brazil
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Prompt Pay
     - THB
     - Thailand
     - |X|
     - |X|
     - |X|
     - |X|
     - |X|
   * - Ratepay
     - EUR, CHF
     - Austria, Germany, Netherlands, Switzerland
     - |V|
     - |V|
     - |V|
     - |V|
     - |X|
   * - Samsung Pay
     - AUD, CAD, CHF, EUR, BGP, HKD, SEK, SGD, USD
     - Australia, Canada, Honk Kong, Singapore, Spain, Sweden, Switzerland, United Kingdom, United
       States
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - SEPA Direct Debit
     - EUR
     - `SEPA countries
       <https://www.europeanpaymentscouncil.eu/document-library/other/epc-list-sepa-scheme-countries>`_
     - |V|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Sofort
     - EUR, CHF
     - Germany, Austria, Belgium, Netherlands, Spain, Switzerland, United Kingdom
     - |X|
     - |X|
     - |V|
     - |V|
     - |V|
   * - Swish
     - SEK
     - Sweden
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Touch'n Go
     - MYR
     - Malaysia
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - Trustly
     - CZK, DKK, EUR, GBP, NOK, SEK
     - Austria, Denmark, Estonia, Finland, Germany, Latvia, Lithuania, Netherlands, Norway, Spain,
       Sweden, United Kingdom
     - |X|
     - |X|
     - |V|
     - |V|
     - |X|
   * - TWINT
     - CHF
     - CH
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - Vipps
     - NOK
     - Norway
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
   * - WeChatPay
     - AUD, CAD, CNY, EUR, GBP, HKD, JPY, NZD, SGD, USD
     - All
     - |X|
     - |X|
     - |V|
     - |X|
     - |X|
   * - Wallets India
     - INR
     - India
     - |X|
     - |X|
     - |V|
     - |X|
     - |X|
   * - Walley
     - DKK, EUR, NOK, SEK
     - Denmark, Finland, Norway, Sweden
     - |V|
     - |V|
     - |V|
     - |V|
     - |X|
   * - Zip
     - AUD, CAD, NZD, USD
     - Australia, Canada, New Zealand, United States
     - |V|
     - |V|
     - |V|
     - |V|
     - |V|
